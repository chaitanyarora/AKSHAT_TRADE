<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="theme-color" content="#071226"/>
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="shortcut icon" href="favicon.ico">
<title>ETH Profit Widget (CoinDCX)</title>

<style>
    /* Global Styles: Ensure full screen dark background and centering setup */
    html, body {
        height: 100%;
        width: 100%;
        margin: 0;
        
        /* CRITICAL: Apply gradient to root background */
        background: linear-gradient(180deg, #071226 0%, #071226 45%, #041022 100%);
        font-family: 'Inter', 'Segoe UI', 'Roboto', 'system-ui', 'Arial', sans-serif;
        color: #e6eef8; 
        box-sizing: border-box;
        
        /* Flexbox for centering */
        display: flex; 
        justify-content: center; 
        align-items: flex-start;

        /* Ensure background extends under notch / home bar */
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        
        background-attachment: fixed;
    }

    /* Wrapper: Handles content width and top padding */
    .wrapper {
        min-height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
        width: 100vw; 
        display: flex;
        justify-content: center; 
        align-items: flex-start;
        padding-top: 20px; 
    }

    /* Widget Container */
    .trade-card {
        background-color: #1a1e27; 
        border-radius: 12px;
        padding: 20px; 
        width: 90%; 
        max-width: 400px;
        margin: 0 10px; 
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        gap: 15px; 
    }

    /* --- CONTENT STYLES --- */
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .pair-info { display: flex; align-items: center; gap: 10px; }
    .pair-name { font-size: 1.3em; font-weight: 600; color: #e6eef8; }
    .long-tag { background-color: #008000; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 500; }
    .action-buttons { display: flex; gap: 10px; }
    .action-buttons button { background: none; border: none; color: #a0a0a0; font-size: 1.2em; cursor: pointer; }

    .pnl-roe-section { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: left; }
    .pnl-item { display: flex; flex-direction: column; }
    .pnl-label, .roe-label { font-size: 0.85em; color: #a0a0a0; margin-bottom: 5px; }
    .pnl-value, .roe-value { font-size: 1.6em; font-weight: 700; }
    .positive { color: #00a000; }
    .negative { color: #d00000; }

    .details-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px 10px; margin-top: 15px; }
    .detail-item { display: flex; flex-direction: column; text-align: left; }
    .detail-label { font-size: 0.8em; color: #a0a0a0; margin-bottom: 3px; }
    .detail-value { font-size: 1em; font-weight: 500; color: #e6eef8; }
</style>
</head>

<body>
    <div class="wrapper">
        <div class="trade-card">
            <div class="card-header">
                <div class="pair-info">
                    <span class="pair-name">ETH • USDT</span>
                    <span id="leverageTag" class="long-tag">Long 1x</span> 
                </div>
                <div class="action-buttons">
                    <button title="Info">ⓘ</button>
                    <button title="Share">↗</button>
                </div>
            </div>

            <div class="pnl-roe-section">
                <div class="pnl-item">
                    <span class="pnl-label">Active PNL</span>
                    <span id="activePnl" class="pnl-value">Loading...</span>
                </div>
                <div class="pnl-item">
                    <span class="roe-label">ROE</span>
                    <span id="roe" class="roe-value">...</span>
                </div>
            </div>

            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Qty (ETH)</span>
                    <span id="qtyEth" class="detail-value">0.027</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Size</span>
                    <span id="sizeValue" class="detail-value">₹9,620.94</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Margin</span>
                    <span id="marginValue" class="detail-value">₹9,529.89</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Avg. Entry (USDT)</span>
                    <span id="avgEntry" class="detail-value">3795.53</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">LTP (USDT)</span>
                    <span id="ltpUsdt" class="detail-value">...</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Liq. Price (USDT)</span>
                    <span id="liqPrice" class="detail-value">41.86</span>
                </div>
            </div>
        </div>
    </div>

<script>
    const API_URL = "https://api.coindcx.com/exchange/ticker";
    const PAIR = "ETHUSDT";
    const REFRESH_INTERVAL_MS = 15000; // 15 seconds

    // --- Hardcoded TRADE DETAILS (UPDATE THESE) ---
    const LEVERAGE = 1; 
    const AVG_ENTRY_PRICE_USD = 3841.72; 
    const QUANTITY_ETH = 0.117; 
    const MARGIN_INR = 41800.48; 
    const USD_INR_RATE = 83.50; 

    // --- Element References ---
    const activePnlElement = document.getElementById('activePnl');
    const roeElement = document.getElementById('roe');
    const ltpUsdtElement = document.getElementById('ltpUsdt');
    const leverageTagElement = document.getElementById('leverageTag');

    leverageTagElement.innerText = `Long ${LEVERAGE}x`;

    /** Calculates and updates PNL & ROE */
    function updateCalculations(ltp) {
        const priceDifference = ltp - AVG_ENTRY_PRICE_USD;
        const pnlUsdt = priceDifference * QUANTITY_ETH;
        const pnlInr = pnlUsdt * USD_INR_RATE;
        const roePercentage = (pnlInr / MARGIN_INR) * 100;

        const pnlText = `${pnlInr >= 0 ? '+' : ''}₹${pnlInr.toFixed(2)}`;
        activePnlElement.innerText = pnlText;
        activePnlElement.classList.remove('positive', 'negative');
        activePnlElement.classList.add(pnlInr >= 0 ? 'positive' : 'negative');

        const roeText = `${roePercentage >= 0 ? '+' : ''}${roePercentage.toFixed(2)}%`;
        roeElement.innerText = roeText;
        roeElement.classList.remove('positive', 'negative');
        roeElement.classList.add(roePercentage >= 0 ? 'positive' : 'negative');
        
        ltpUsdtElement.innerText = ltp.toFixed(2);
    }

    /** Fetches ticker data and updates UI */
    async function fetchAndUpdateTradeCard() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error(`HTTP error! ${response.status}`);
            const data = await response.json();
            const ticker = data.find(t => t.market === PAIR);

            if (ticker) {
                const lastPrice = parseFloat(ticker.last_price);
                updateCalculations(lastPrice);
            } else {
                ltpUsdtElement.innerText = 'N/A';
                activePnlElement.innerText = 'Error';
                roeElement.innerText = 'Error';
            }
        } catch (error) {
            console.error("Failed to fetch ticker data:", error);
            ltpUsdtElement.innerText = 'Fetch Error';
            activePnlElement.innerText = 'Error';
            roeElement.innerText = 'Error';
        }
    }

    fetchAndUpdateTradeCard(); 
    setInterval(fetchAndUpdateTradeCard, REFRESH_INTERVAL_MS);
</script>
</html>


